{% block body_class %}bg-chat{% endblock %}

{% extends "base.html" %}
{% block title %}Chat · Veterans Companion{% endblock %}
{% block content %}
<div class="alert alert-warning border shadow-sm">
  <strong>Important:</strong> Emotional support only — <em>Not medical or legal advice</em>.
  In crisis, call <strong>988 (Press 1)</strong>.
</div>

{% if messages %}
  {% for m in messages %}
    <div class="alert alert-{{ m.tags }}">{{ m }}</div>
  {% endfor %}
{% endif %}

<div class="p-3 p-md-4 bg-white shadow-sm rounded-3">
  <h2 class="h5 mb-3">Chat</h2>

  <div class="mb-3" style="max-height: 50vh; overflow:auto; border: 1px solid #eee; border-radius: .5rem; padding: 1rem;">
    {% if history %}
      {% for msg in history %}
        {% if msg.role == "user" %}
          <div class="mb-2">
            <div class="fw-bold">You</div>
            <div>{{ msg.content|linebreaksbr }}</div>
            <div class="text-muted small">{{ msg.created_at }}</div>
          </div>
        {% else %}
          <div class="mb-3 ps-3 border-start">
            <div class="fw-bold">Assistant</div>
            <div>{{ msg.content|linebreaksbr }}</div>
            <div class="text-muted small">{{ msg.created_at }}</div>
          </div>
        {% endif %}
      {% endfor %}
    {% else %}
      <p class="text-muted mb-0">No messages yet — I am happy to help, describe your mental health condition below.</p>
    {% endif %}
  </div>

  <form method="post" class="mt-3">
    {% csrf_token %}
    <div class="mb-3">
      <label for="message" class="form-label">What are you struggling with today?</label>
      <textarea id="message" name="message" rows="3" class="form-control" placeholder="Type here..." required></textarea>
    </div>
    <button class="btn btn-primary">Send</button>
  </form>
</div>
{% endblock %}
